```table-of-contents
```

# CommonJS modules

2 main concept cá»§a CommonJS:
 * `require` lÃ  má»™t function cho phÃ©p import má»™t module tá»« `local filesystem`
 * `exports` vÃ  `module.exports` lÃ  cÃ¡c biáº¿n Ä‘áº·c biá»‡t, Ä‘Æ°á»£c sá»­ dá»¥ng Ä‘á»ƒ export cÃ¡c public functionality tá»« module hiá»‡n táº¡i.

## Module loader

Äá»ƒ hiá»ƒu Ä‘Æ°á»£c cÃ¡ch CommonJS lÃ m viá»‡c, ta sáº½ tá»± build má»™t system tÆ°Æ¡ng tá»±
Äoáº¡n code sau táº¡o má»™t function mÃ´ phá»ng má»™t sá»‘ tÃ­nh nÄƒng cá»§a `require()` function. Táº¡o ra má»™t function, load the content of a module, wraps it into a private scope

```js
function loadModule (filename, module, require) {
	const wrappedSrc =
		`(function (module, exports, require) {
			${fs.readFileSync(filename, 'utf8')}
		})(module, module.exports, require)`
	eval(wrappedSrc)
}
```

Implement hÃ m `require()` function

```js
function require (moduleName) {
	console.log(`Require invoked for module: ${moduleName}`)
	const id = require.resolve(moduleName) // (1)
	if (require.cache[id]) { // (2)
		return require.cache[id].exports
	}
	// module metadata
	const module = { // (3)
		exports: {},
		id
	}
	// Update the cache
	require.cache[id] = module // (4)

	// load the module
	loadModule(id, module, require) // (5)
	
	// return exported variables
	return module.exports // (6)
}
require.cache = {}
	require.resolve = (moduleName) => {
	/* resolve a full module id from the moduleName */
}
```

1. hÃ m `require` sáº½ nháº­n vÃ o path cá»§a module, `require.resolve()` sáº½ phÃ¢n giáº£i ra full path cá»§a module Ä‘Ã³ trÃªn disk, vÃ  coi full path Ä‘Ã³ lÃ  `id` cá»§a module
2. Náº¿u module Ä‘Ã£ Ä‘Æ°á»£c load trÆ°á»›c Ä‘Ã³ (Ä‘Ã£ Ä‘Æ°á»£c cache láº¡i) â‡’ ngay láº­p tá»©c return module
3. Náº¿u module chÆ°a Ä‘Æ°á»£c load láº§n nÃ o, sáº½ táº¡o environment cho first load, táº¡o má»™t `module` object bao gá»“m `exports`
4. LÆ°u module object vÃ o cache
5. load code tá»« file path trÃªn disk, gÃ¡n cÃ¡c funtion Ä‘á»ƒ export module Ä‘Ã³ ra ngoÃ i, gá»i tiáº¿p `require()` náº¿u cáº§n
6. Tráº£ vá» `module.exports` cho caller
### Giáº£i thÃ­ch

Cáº¥u trÃºc `(function (...) { ... })(...)` lÃ  má»™t **IIFE â€“ Immediately Invoked Function Expression** , hÃ m Ä‘Æ°á»£c Ä‘á»‹nh nghÄ©a vÃ  gá»i ngay láº­p tá»©c 

VÃ­ dá»¥:
```js
(function (x) {
  console.log("Hello " + x);
})("world");
```

- Äá»‹nh nghÄ©a má»™t hÃ m `(x) => { ... }`.
- Rá»“i **gá»i nÃ³ ngay láº­p tá»©c** vá»›i tham sá»‘ `"world"`
âœ… Káº¿t quáº£ in ra: `Hello world`.

function `LoadModule` trÃªn sáº½ Ä‘á»c ná»™i dung cá»§a file Ä‘Æ°á»£c import, wrap vÃ  thá»±c thi toÃ n bá»™ code cá»§a file trong má»™t function riÃªng biá»‡t (function Ä‘Ã³ sáº½ cÃ³ scope riÃªng).

`math.js`

```js
console.log("â–¶ math.js Ä‘ang cháº¡y");
console.log("1ï¸âƒ£ exports === module.exports:", exports === module.exports);  // true

exports.add = (a, b) => a + b;
exports.sub = (a, b) => a - b;

// DÃ²ng nÃ y sáº½ khÃ´ng hoáº¡t Ä‘á»™ng náº¿u dÃ¹ng exports = {...} vÃ¬ máº¥t liÃªn káº¿t vá»›i module.exports
```

`main.js` dÃ¹ng `require()` Ä‘á»ƒ gá»i `math.js`

```js
const math = require('./math.js');

console.log("â–¶ Gá»i hÃ m add:", math.add(5, 3)); // 8
console.log("â–¶ Gá»i hÃ m sub:", math.sub(5, 3)); // 2
```

Báº£n cháº¥t khi gá»i `require('./math.js')`, Nodejs Ä‘Ã£ thá»±c hiá»‡n cÃ¡c hÃ nh vi

```js
// BÆ°á»›c 1: Táº¡o object module
const module = {
  exports: {}
};

// BÆ°á»›c 2: Äá»‹nh nghÄ©a biáº¿n exports (tham chiáº¿u tá»›i module.exports)
let exports = module.exports;

// BÆ°á»›c 3: Wrap ná»™i dung file math.js vÃ o hÃ m:
(function (module, exports, require) {
  // ----- ÄÃ¢y lÃ  ná»™i dung tháº­t cá»§a math.js -----
  console.log("â–¶ math.js Ä‘ang cháº¡y");

  console.log("1ï¸âƒ£ exports === module.exports:", exports === module.exports);

  exports.add = (a, b) => a + b;
  exports.sub = (a, b) => a - b;
  // ---------------------------------------------
})(module, module.exports, require);

// BÆ°á»›c 4: Tráº£ vá» giÃ¡ trá»‹ tá»« module.exports
return module.exports;

```

`Module` lÃ  Ä‘á»‘i tÆ°á»£ng gá»‘c Ä‘áº¡i diá»‡n cho module
* `module.exports` lÃ  nÆ¡i chá»©a cÃ¡c function, giÃ¡ trá»‹ muá»‘n public ra cho cÃ¡c file khÃ¡c
* GiÃ¡ trá»‹ tráº£ vá» tá»« `require()` chÃ­nh lÃ  `module.exports`
* `exports` vÃ  `module.exports` cÃ¹ng ***trá» tá»›i má»™t vÃ¹ng nhá»›***.

`exports` lÃ  tham chiáº¿u tá»›i `module.exports`
* Náº¿u **gÃ¡n láº¡i exports = {...}**, thÃ¬ `exports` lÃºc nÃ y sáº½ bá»‹ trá» sang vÃ¹ng nhá»› khÃ¡c, khÃ´ng cÃ²n cÃ¹ng vÃ¹ng nhá»› vá»›i `module.exports`, do Ä‘Ã³ káº¿t quáº£ `require()` tráº£ vá» `{}` rá»—ng

`require` lÃ  hÃ m Nodejs cung cáº¥p Ä‘á»ƒ load cÃ¡c module khÃ¡c, náº¿u muá»‘n trong `math.js` váº«n tiáº¿p tá»¥c `require()` Ä‘á»ƒ load cÃ¡c module khÃ¡c.



## PhÃ¢n biá»‡t `module.exports` vÃ  `exports`

Vá» báº£n cháº¥t, `exports` lÃ  má»™t reference cá»§a `module.exports`, giá»‘ng nhÆ° viá»‡c gÃ¡n `exports = module.exports`
Cáº£ hai Ä‘á»u trá» Ä‘áº¿n cÃ¹ng má»™t vÃ¹ng nhá»›, khi muá»‘n export má»™t object nÃ o Ä‘Ã³, ta chá»‰ viá»‡c thÃªm thuá»™c tÃ­nh má»›i cho `exports`
```js
exports.hello = () => {
	console.log("Hello")
}
```

Tuy nhiÃªn, náº¿u trong code, ta gÃ¡n láº¡i giÃ¡ trá»‹ cho biáº¿n `exports`
```js
exports = () => {
	console.log('Hello')
}
```

LÃºc nÃ y vÃ¹ng nhá»› mÃ  biáº¿n `exports` trá» tá»›i Ä‘Ã£ Ä‘Æ°á»£c gÃ¡n láº¡i, khÃ´ng cÃ²n trá» tá»›i cÃ¹ng má»™t vá»‹ trÃ­ vá»›i `module.exports`, vÃ¬ tháº¿ khi module khÃ¡c `require` module Ä‘Ã³, object Ä‘Æ°á»£c lÆ°u trong `exports` sáº½ khÃ´ng Ä‘Æ°á»£c public ra ngoÃ i.

## `require` lÃ  má»™t synchronous function

| Ná»™i dung                          | Giáº£i thÃ­ch ngáº¯n                                  |
| --------------------------------- | ------------------------------------------------ |
| `require()` lÃ  synchronous        | Tráº£ káº¿t quáº£ ngay láº­p tá»©c, khÃ´ng dÃ¹ng callback    |
| `module.exports` pháº£i gÃ¡n Ä‘á»“ng bá»™ | KhÃ´ng nÃªn dÃ¹ng `setTimeout`, `fs.readFile`, v.v. |
| Náº¿u cáº§n async init                | Export `init()` hoáº·c Promise rÃµ rÃ ng             |
| Node.js tá»«ng cÃ³ `require()` async | NhÆ°ng bá» vÃ¬ quÃ¡ phá»©c táº¡p, khÃ´ng Ä‘Ã¡ng             |

## Thuáº­t toÃ¡n resolving

***dependency hell*** sáº£y ra khi hai hoáº·c nhiá»u dependency trong má»™t chÆ°Æ¡ng trÃ¬nh Ä‘á»u phá»¥ thuá»™c vÃ o *1 shared dependency*, nhÆ°ng láº¡i yÃªu cáº§u ***2 version khÃ¡c nhau***.

CÃ¡c package managers cá»§a Nodejs xá»­ lÃ½ váº¥n Ä‘á» nÃ y báº±ng cÃ¡ch tá»• chá»©c láº¡i cÃ¡c dependencies cá»§a á»©ng dá»¥ng vÃ  sá»­ dá»¥ng thuáº­t toÃ¡n resolving trong `require()`.

Trong mÃ£ nguá»“n cá»§a `require()`, hÃ m `resolve()` nháº­n vÃ o má»™t ***module name*** vÃ  tráº£ vá» ***full path*** cá»§a module.
***Full path*** Ä‘Æ°á»£c sá»­ dá»¥ng Ä‘á»ƒ load code vÃ  lÃ m Ä‘á»‹nh danh cho module Ä‘Ã³.

Khi gá»i `require(moduleName)`, nodejs sáº½ xá»­ lÃ½ `moduleName` theo 3 cÃ¡ch:

***1. File modules***
* Náº¿u `moduleName` báº¯t Ä‘áº§u báº±ng `/` â†” `absolute path` â‡’ return luÃ´n full path Ä‘Ã³
* Náº¿u `moduleName` báº±ng Ä‘áº§u báº±ng `./` â†” `relative path` â‡’ TÃ­nh toÃ¡n ra `absolute path` vÃ  return
***2. Core modules***
* Náº¿u `moduleName` khÃ´ng cÃ³ prefix `/` hoáº·c `./` â‡’ thuáº­t toÃ¡n sáº½ tÃ¬m kiáº¿m trong core Nodejs module theo tÃªn cá»§a module

***3. Package modules***
* Náº¿u khÃ´ng cÃ³ core module nÃ o matching vá»›i `moduleName`, Node báº¯t Ä‘áº§u tÃ¬m **package** trong cÃ¡c thÆ° má»¥c `node_modules/`
* Quy táº¯c:
	- TÃ¬m trong `node_modules/` cÃ¹ng cáº¥p vá»›i file hiá»‡n táº¡i
	- Náº¿u khÃ´ng tháº¥y â†’ Ä‘i lÃªn cáº¥p cha â†’ tÃ¬m tiáº¿p
	- Cá»© tiáº¿p tá»¥c nhÆ° váº­y cho Ä‘áº¿n khi gáº·p root filesystem

Khi tÃ¬m kiáº¿m má»™t module theo `moduleName` trong cÃ¢y thÆ° má»¥c, Nodejs sáº½ tÃ¬m kiáº¿m theo cÃ¡c kháº£ nÄƒng sau

**1. `<moduleName>.js`**

Náº¿u viáº¿t `require('./math')` , nodejs sáº½ tÃ¬m cÃ¡c file cÃ³ tÃªn `./math.js`, náº¿u tÃ¬m tháº¥y sáº½ dá»«ng láº¡i vÃ  load ná»™i dung file nÃ y.

**2. `<moduleName>/index.js`***

Náº¿u `require('./utils')` trá» tá»›i má»™t thÆ° má»¥c, Nodejs sáº½ kiá»ƒm tra trong thÆ° má»¥c Ä‘Ã³ cÃ³ file `index.js` hay khÃ´ng.
Náº¿u cÃ³, Node dÃ¹ng file `index.js` nÃ y lÃ m entrypoint cá»§a module vÃ  load code.

**3. TÃ¬m theo giÃ¡ trá»‹ cá»§a name trong `package.json`**

Náº¿u `moduleName` trá» Ä‘áº¿n má»™t `package` trong `node_modules`, Node sáº½ kiá»ƒm tra file `package.json` trong thÆ° má»¥c Ä‘Ã³
Náº¿u biáº¿n `name` trong `package.json` trÃ¹ng vá»›i `moduleName` thÃ¬ sáº½ return fullpath

VÃ­ dá»¥: 
```json
// node_modules/math-package/package.json
{
  "name": "math-package",
  "main": "lib/main.js"
}
```
Khi import thÆ° viá»‡n nÃ y
```js
require('math-package')
```
Node sáº½ resolve full path thÃ nh 
```lua
node_modules/math-package/lib/main.js
```

<span style="color:rgb(255, 0, 0)">Náº¿u khÃ´ng cÃ³ field <code style="font-weight: bold">main</code>, Node máº·c Ä‘á»‹nh dÃ¹ng <code style="font-weight: bold">index.js</code></span>.

### VÃ­ dá»¥ vá» load module trong private dependency

```bash
myApp
â”œâ”€â”€ foo.js
â””â”€â”€ node_modules
	â”œâ”€â”€ depA
	â”‚   â””â”€â”€ index.js
	â”œâ”€â”€ depB
	â”‚   â”œâ”€â”€ bar.js
	â”‚   â””â”€â”€ node_modules
	â”‚ 	    â””â”€â”€ depA
	â”‚           â””â”€â”€ index.js
	â””â”€â”€ depC
		â”œâ”€â”€ foobar.js
		â””â”€â”€ node_modules
			â””â”€â”€ depA
				â””â”€â”€ index.js
```

Náº¿u gá»i <code style="font-weight: bold">require('depA')</code> tá»« file <code style="font-weight: bold">/myApp/foo.js</code>, chÆ°Æ¡ng trÃ¬nh sáº½ load file <code style="font-weight: bold">/myApp/node_modules/depA/index.js</code>

Náº¿u gá»i <code style="font-weight: bold">require('depA')</code> tá»« file <code style="font-weight: bold">/myApp/node_modules/depB/bar.js</code>, chÆ°Æ¡ng trÃ¬nh sáº½ load file <code style="font-weight: bold">/myApp/node_modules/depB/node_modules/depA/index.js</code>

Náº¿u gá»i <code style="font-weight: bold">require('depA')</code> tá»« file <code style="font-weight: bold">/myApp/node_modules/depC/foobar.js</code>, chÆ°Æ¡ng trÃ¬nh sáº½ load file <code style="font-weight: bold">/myApp/node_modules/depC/node_modules/depA/index.js</code>

---
## Module cache

Má»—i module chá»‰ Ä‘Æ°á»£c load vÃ  thá»±c thi bá»Ÿi nodejs má»™t láº§n duy nháº¥t (lÃ  láº§n load Ä‘áº§u tiÃªn), á»Ÿ cÃ¡c láº§n import sau thÃ¬:
- Node.js **khÃ´ng cháº¡y láº¡i mÃ£ nguá»“n**.
- Node.js chá»‰ **tráº£ vá» object Ä‘Ã£ export tá»« láº§n Ä‘áº§u** (tá»« cache) thÃ´ng qua biáº¿n `require.cache`

---
## Cirular dependencies

**Circular dependency** xáº£y ra khi Module `a.js` require `b.js`, vÃ  `b.js` láº¡i require ngÆ°á»£c láº¡i `a.js`.
Hiá»‡n tÆ°á»£ng nÃ y gÃ¢y ra `phá»¥ thuá»™c chÃ©o` trong code, lÃ m code khÃ³ hiá»ƒu, khÃ³ báº£o trÃ¬.
VÃ­ dá»¥

Module `a.js`
```js
exports.loaded = false
const b = require('./b')
module.exports = {
	b,
	loaded: true // overrides the previous export
}
```

Module `b.js`
```js
exports.loaded = false
const a = require('./a')
module.exports = {
	a,
	loaded: true
}
```

Khi cháº¡y `main.js`
```js
const a = require('./a')
const b = require('./b')
console.log('a ->', JSON.stringify(a, null, 2))
console.log('b ->', JSON.stringify(b, null, 2))
```

Khi `cicular dependency` sáº£y ra, luá»“ng logic sáº½ nhÆ° sau:
1. Process start `main.js`, ngay láº­p tá»©c import `a.js`, `a.js` sáº½ export `loaded = false`
2. Sau Ä‘Ã³, `a.js` require module `b.js`, `b.js` báº¯t Ä‘áº§u Ä‘Æ°á»£c thá»±c thi, `b.js` export `loaded = false`
3. `b.js` láº¡i require láº¡i `a.js` (***circular***), tuy nhiÃªn, Node tháº¥y `a.js` Ä‘Ã£ Ä‘Æ°á»£c require trÆ°á»›c Ä‘Ã³ rá»“i â‡’ ***tráº£ vá» module tá»« cache***
	* LÃºc nÃ y `a.js` ***chÆ°a thá»±c thi xong***, nÃªn Node chá»‰ tráº£ vá» `{ loaded: false }`
	* `b.js` sáº½ tháº¥y `a.js.loaded == false`
4. `b.js` cháº¡y xong â‡’ cáº­p nháº­t `loaded = true`
5. Sau khi `b.js` cháº¡y xong, luá»“ng thá»±c thi quay láº¡i `a.js`
	* `a.js` tháº¥y Ä‘Æ°á»£c `b.js` tráº£ vá» `loaded = true`
	* `a.js` cáº­p nháº­t láº¡i `loaded = true`
6. `a.js` cháº¡y xong, luá»“ng thá»±c thi trá»Ÿ láº¡i `main.js`
	* Node tráº£ vá» `module.exports` cá»§a `a.js` vá»›i `loaded = true`
7. `main.js` gá»i tiáº¿p `require('b.js')`
	* `b.js` Ä‘Æ°á»£c cache sáºµn vÃ  tráº£ vá» `{ loaded: true }`

âŒ ***Há»‡ quáº£***:

- **Circular dependency khÃ´ng lÃ m Node.js crash**, nhÆ°ng gÃ¢y **káº¿t quáº£ khÃ´ng nháº¥t quÃ¡n**.
- Viá»‡c má»™t module "tháº¥y" báº£n chÆ°a hoÃ n chá»‰nh cá»§a module khÃ¡c cÃ³ thá»ƒ gÃ¢y bug khÃ³ lÆ°á»ng.
- Trong **CommonJS**:
    - `require()` lÃ  Ä‘á»“ng bá»™ (synchronous)
    - Module Ä‘Æ°á»£c thá»±c thi **ngay láº­p tá»©c** khi require.
    - Náº¿u Ä‘ang require giá»¯a chá»«ng â†’ Node tráº£ vá» báº£n `module.exports` Ä‘ang _cÃ³ hiá»‡n táº¡i_ (dÃ¹ cÃ²n chÆ°a Ä‘áº§y Ä‘á»§).

âœ… ***CÃ¡ch giáº£i quyáº¿t***

- **TÃ¡ch module** thÃ nh pháº§n chia sáº» ra module phá»¥ (khÃ´ng circular).
- **DÃ¹ng lazy `require()` trong function**, khÃ´ng á»Ÿ top-level.
- **Refactor code** Ä‘á»ƒ loáº¡i bá» sá»± phá»¥ thuá»™c vÃ²ng.


--- 

# ESM (ES modules) trong Nodejs

## Sá»­ dá»¥ng ESM trong nodejs

Máº·c Ä‘á»‹nh, Nodejs coi má»i file `.js` sáº½ Ä‘Æ°á»£c viáº¿t theo syntax cá»§a CommonJS.
VÃ¬ tháº¿, náº¿u sá»­ dá»¥ng ESM syntax trong má»™t `.js` file, interpreter sáº½ bá»‹ lá»—i.
CÃ³ má»™t sá»‘ cÃ¡ch Ä‘á»ƒ cáº¥u hÃ¬nh Nodejs interpreter sáº½ Ä‘á»c syntax theo ES module thay vÃ¬ CommonJS module
* Äáº·t tÃªn cá»§a file lÃ  `.mjs` thay vÃ¬ `.js`
* trong file `package.js` á»Ÿ thÆ° má»¥c cha gáº§n nháº¥t, sá»­a trÆ°á»ng `type: module`.

## Named exports and imports

Trong má»™t ES module, má»i thá»© Ä‘á»u máº·c Ä‘á»‹nh lÃ  `private scope`, chá»‰ khi Ä‘Æ°á»£c `export` thÃ¬ cÃ¡c module bÃªn ngoÃ i má»›i truy cáº­p Ä‘Æ°á»£c.
ESM cho phÃ©p export má»™t function tá»« má»™t module thÃ´ng qua tá»« khÃ³a `export`

```js
// logger.js
// exports a function as `log`
export function log (message) {
	console.log(message)
}
// exports a constant as `DEFAULT_LEVEL`
export const DEFAULT_LEVEL = 'info'
// exports an object as `LEVELS`
export const LEVELS = {
	error: 0,
	debug: 1,
	warn: 2,
	data: 3,
	info: 4,
	verbose: 5
}
// exports a class as `Logger`
export class Logger {
	constructor (name) {
		this.name = name
	}
	
	log (message) {
		console.log(`[${this.name}] ${message}`)
	}
}
```

```js
import * as loggerModule from './logger.js'
console.log(loggerModule)
```

Trong cÃ¡c cÃº phÃ¡p import trÃªn, `*` Ä‘Æ°á»£c gá»i lÃ  ***namespace import***, Ä‘Æ°á»£c sá»­ dá»¥ng Ä‘á»ƒ import toÃ n bá»™ cÃ¡c members cá»§a module vÃ  gÃ¡n chÃºng vÃ o biáº¿n local `loggerModule`.

Trong trÆ°á»ng há»£p cÃ¡c module quÃ¡ lá»›n, chá»‰ muá»‘n import má»™t hoáº·c má»™t sá»‘ function trong module

```js
import { log, Logger } from './logger.js'
import { log as log2 } from './logger.js'

log('Hello World')
log2('Hello 2')
const logger = new Logger('DEFAULT')
logger.log('Hello world')
```

> ğŸ’¡ <span style="color:rgb(255, 0, 0)">CÃ¡c biáº¿n import Ä‘á»u lÃ  immutable vÃ  khÃ´ng thá»ƒ khai bÃ¡o láº¡i trong cÃ¹ng scope</span>

VÃ­ dá»¥:
```js
import { log } from './logger.js'
const log = console.log // Biáº¿n log á»Ÿ Ä‘Ã¢y lÃ  immutable, khÃ´ng thá»ƒ bá»‹ gÃ¡n láº¡i
```

## Default exports vÃ  imports

### âœ… **1. CommonJS â€“ `module.exports`**

Trong CommonJS (há»‡ thá»‘ng module dÃ¹ng trong Node.js), báº¡n cÃ³ thá»ƒ xuáº¥t má»™t thá»±c thá»ƒ duy nháº¥t báº±ng cÃ¡ch gÃ¡n nÃ³ cho `module.exports`, vÃ­ dá»¥:
```js
// logger.js (CommonJS)
function log(message) {
  console.log(message)
}

module.exports = log
```

- á» Ä‘Ã¢y báº¡n **khÃ´ng Ä‘áº·t tÃªn cá»¥ thá»ƒ** cho export.
- File `logger.js` **chá»‰ export má»™t thá»±c thá»ƒ duy nháº¥t**: hÃ m `log`.
- Khi import dÃ¹ng CommonJS:

```js
const log = require('./logger')
log('Hello')
```

### âœ… **2. ESM â€“ `export default`**

Trong ESM (há»‡ thá»‘ng module hiá»‡n Ä‘áº¡i cá»§a JavaScript, dÃ¹ng trong trÃ¬nh duyá»‡t vÃ  Node.js hiá»‡n nay), cÃ³ má»™t cÃ¡ch tÆ°Æ¡ng tá»±: **`export default`**.

> ğŸ’¡<span style="color:rgb(255, 0, 0)">Trong má»™t module, chá»‰ cÃ³ thá»ƒ export default má»™t láº§n duy nháº¥t</span>

VÃ­ dá»¥:
```js
// logger.js (ESM)
export default function log(message) {
  console.log(message)
}
```

- á» Ä‘Ã¢y **chá»‰ export má»™t thá»±c thá»ƒ duy nháº¥t**, nhÆ°ng dÃ¹ng cÃº phÃ¡p `export default`.
- Khi import:

```js
import log from './logger.js'
log('Hello')

```
ğŸ’¡ Giá»‘ng nhÆ° CommonJS, báº¡n **khÃ´ng cáº§n biáº¿t tÃªn hÃ m gá»‘c trong file lÃ  gÃ¬**, báº¡n Ä‘áº·t tÃªn gÃ¬ khi import cÅ©ng Ä‘Æ°á»£c.

So sÃ¡nh giá»¯a `Named exports` vÃ  `default export`

| KhÃ­a cáº¡nh                      | Named exports           | Default export                                 |
| ------------------------------ | ----------------------- | ---------------------------------------------- |
| RÃµ rÃ ng, dá»… há»— trá»£ IDE         | âœ… TÃªn cá»¥ thá»ƒ            | âŒ TÃªn tÃ¹y Ã½ khi import                         |
| PhÃ¹ há»£p khi cÃ³ nhiá»u tÃ­nh nÄƒng | âœ…                       | âŒ Chá»‰ nÃªn dÃ¹ng khi module cÃ³ 1 chá»©c nÄƒng chÃ­nh |
| Tá»‘i Æ°u tree-shaking            | âœ… Tá»‘t hÆ¡n               | âŒ KhÃ³ tá»‘i Æ°u náº¿u export object lá»›n             |
| Import dá»… nhá»›                  | âŒ Cáº§n nhá»› tÃªn chÃ­nh xÃ¡c | âœ… KhÃ´ng cáº§n nhá»› tÃªn Ä‘á»‹nh nghÄ©a gá»‘c             |


---

## Mixed exports

Trong ES module, chÃºng ta cÃ³ thá»ƒ ***export default má»™t láº§n duy nháº¥t***, nhÆ°ng **==cÃ³ thá»ƒ export thÃ´ng thÆ°á»ng nhiá»u láº§n==**.

```js
// logger.js
export default function log (message) {
	console.log(message)
}
export function info (message) {
	log(`info: ${message}`)
}
```

Trong vÃ­ dá»¥ trÃªn, ta export má»™t `log` function nhÆ° má»™t `default export` vÃ  `named export` cho function `info`.

```js
import mylog, { info } from './logger.js'
```

Import default export tá»« `.js` vá»›i biáº¿n `mylog`, vÃ  import named export cho `info`


## Async Import

